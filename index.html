<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRC 6998 – Scanner Upload</title>
<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<style>
body{font-family:sans-serif;background:#121218;color:#F2F2F2;text-align:center;}
#reader{width:320px;margin:20px auto;}
button{margin:10px;padding:10px 14px;font-weight:bold;border-radius:12px;background:#D4AF37;border:none;color:#121218;cursor:pointer;}
#log{margin-top:14px;max-height:200px;overflow-y:auto;background:#1A1A1F;padding:10px;border-radius:10px;}
</style>
</head>
<body>
<h1>FRC 6998 – QR Scanner & Upload</h1>
<div id="reader"></div>
<button onclick="stopScan()">Stop Scanning</button>
<button onclick="startScan()">Start Scanning</button>
<h3>Upload Log</h3>
<div id="log"></div>

<script>
let html5QrcodeScanner;

function startScan(){
  html5QrcodeScanner = new Html5Qrcode("reader");
  html5QrcodeScanner.start(
    { facingMode: "environment" },
    { fps:10, qrbox:250 },
    qrCodeMessage => {
      log("QR scanned: " + qrCodeMessage);
      try{
        const data = JSON.parse(qrCodeMessage);
        uploadToSheet(data);
      }catch(e){
        log("Invalid QR JSON");
      }
    },
    errorMessage => { /* optional errors */ }
  );
}

function stopScan(){
  if(html5QrcodeScanner) html5QrcodeScanner.stop().then(()=>log("Scanning stopped")).catch(console.error);
}

function log(msg){ const l=document.getElementById("log"); l.innerHTML+=msg+"<br>"; l.scrollTop=l.scrollHeight; }

function uploadToSheet(data){
  const url="https://script.google.com/macros/s/AKfycbxFz_p2jiz9BUyuZCdIAwz6kTyveJ6nQrNLIJOvMSNrDo0d2W9vWYMtSePDKoocNSZjZw/exec"; // replace with deployed Apps Script URL
  fetch(url,{
    method:"POST",
    body: JSON.stringify(data),
    headers: {"Content-Type":"application/json"}
  }).then(r=>r.text()).then(t=>log("Uploaded: "+t)).catch(e=>log("Upload error: "+e));
}
</script>
</body>
</html>
